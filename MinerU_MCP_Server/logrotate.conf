# MinerU MCP Server 日志轮转配置
# 路径: /etc/logrotate.d/mineru-mcp

/var/log/mineru-mcp/*.log {
    # 每天轮转
    daily

    # 保留 14 天
    rotate 14

    # 如果日志文件不存在，不报错
    missingok

    # 不轮转空文件
    notifempty

    # 压缩旧日志
    compress

    # 延迟压缩（等到下次轮转时再压缩）
    delaycompress

    # 使用日期作为后缀
    dateext
    dateformat -%Y%m%d

    # 轮转后的文件权限
    create 0640 mineru-mcp mineru-mcp

    # 共享脚本（所有日志文件轮转后只执行一次）
    sharedscripts

    # 轮转后执行的操作
    postrotate
        # 如果使用 systemd，重新加载服务以打开新日志文件
        if systemctl is-active --quiet mineru-mcp; then
            systemctl reload mineru-mcp > /dev/null 2>&1 || true
        fi

        # 如果使用 supervisor
        if supervisorctl status mineru-mcp > /dev/null 2>&1; then
            supervisorctl signal HUP mineru-mcp > /dev/null 2>&1 || true
        fi
    endscript
}

# Docker 日志配置
# 注意：Docker 容器日志通常在 docker-compose.yml 中配置
# 如果需要轮转容器日志，可以添加：
# /var/lib/docker/containers/*/*.log {
#     rotate 7
#     daily
#     compress
#     missingok
#     delaycompress
#     copytruncate
# }
